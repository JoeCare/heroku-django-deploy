name: Deploy Tests

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]


jobs:
  heroku_git_deploy_job:
      runs-on: ubuntu-latest
      defaults:
        run:
          working-directory: ./tests/djangoherokuapp
      name: Git Deploy job- A job to deploy django app to heroku using git
      steps:
        - name: Checkout
          uses: actions/checkout@v2
          working-directory: ./tests/djangoherokuapp
        - name: Deploy django to heroku
          working-directory: ./tests/djangoherokuapp
          uses: nyakaz73/heroku-django-deploy@v0.54 #Uses an action in the root directory
          id: deploy 
          with: 
            heroku_app_name : ${{ secrets.HEROKU_APP_NAME }}
            heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
            heroku_email_address: 'tafadzwalnyamukapa@gmail.com'
          
        #Use the output  from the hello step
        - name: Get the output status
          run: echo "${{ steps.deploy.outputs.status }}"
  
  heroku_docker_deploy_job:
      runs-on: ubuntu-latest
      defaults:
        run:
          working-directory: ./tests/djangoherokuapp
      name: Container registry deploy- A job to deplo django app to heroku with container registry
      steps:
        - name: Checkout
          uses: actions/checkout@v2
        - name: Deploy django to heroku
          uses: nyakaz73/heroku-django-deploy@v0.54 #Uses an action in the root directory
          id: deploy 
          with: 
            heroku_app_name : ${{ secrets.HEROKU_APP_NAME_DOCKER }}
            heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
            heroku_email_address: 'tafadzwalnyamukapa@gmail.com'
            use_docker: true
            
        #Use the output  from the hello step
        - name: Get the output status
          run: echo "${{ steps.deploy.outputs.status }}"


  heroku_manifest_deploy_job:
      runs-on: ubuntu-latest
      defaults:
        run:
          working-directory: ./tests/djangoherokuapp
      name: Build Manifest deploy-A job to deploy django app to heroku Build Manifest
      steps:
        - name: Checkout
          uses: actions/checkout@v2
        - name: Deploy django to heroku
          uses: nyakaz73/heroku-django-deploy@v0.54 #Uses an action in the root directory
          id: deploy 
          with: 
            heroku_app_name : ${{ secrets.HEROKU_APP_NAME_MANIFEST }}
            heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
            heroku_email_address: 'tafadzwalnyamukapa@gmail.com'
            use_build_manifest: true
            
        #Use the output  from the hello step
        - name: Get the output status
          run: echo "${{ steps.deploy.outputs.status }}"
  
          